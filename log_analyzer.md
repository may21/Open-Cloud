## ğŸ“œ log\_analyzer.py ìŠ¤í¬ë¦½íŠ¸ ë©”ë‰´ì–¼ (md)

# log\_analyzer.py: UFW ë¡œê·¸ ë° GeoIP ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸

## 1\. ğŸ“‹ ê°œìš”

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” Linux ì„œë²„ì˜ UFW (Uncomplicated Firewall) ë¡œê·¸ íŒŒì¼ì„ ë¶„ì„í•˜ì—¬, ì„œë²„ì— ì ‘ì†ì„ ì‹œë„í•œ **ìƒìœ„ Nê°œì˜ IP ì£¼ì†Œ**ë¥¼ ì§‘ê³„í•©ë‹ˆë‹¤.

í•µì‹¬ ê¸°ëŠ¥ìœ¼ë¡œ, ì§‘ê³„ëœ ìƒìœ„ IPë“¤ì˜ **ì§€ë¦¬ì  ìœ„ì¹˜(êµ­ê°€, ë„ì‹œ)ë¥¼ 3ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ Geo-IP APIë¥¼ í†µí•´ ì¡°íšŒ**í•˜ì—¬ ê²°ê³¼ë¥¼ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ **CSV í˜•ì‹**ìœ¼ë¡œ í‘œì¤€ ì¶œë ¥(stdout)í•©ë‹ˆë‹¤.

ì´ë¥¼ í†µí•´ ê´€ë¦¬ìëŠ” ì–´ë–¤ IPê°€, ì–´ë–¤ í¬íŠ¸ë¡œ, ì–¼ë§ˆë‚˜ ìì£¼ ì ‘ì†ì„ ì‹œë„í–ˆëŠ”ì§€, ê·¸ë¦¬ê³  ê·¸ IPì˜ ë°œì‹ ì§€ê°€ ì–´ë””ì¸ì§€ í•œëˆˆì— íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## 2\.  âœ¨ ì£¼ìš” ê¸°ëŠ¥

  * **UFW ë¡œê·¸ íŒŒì‹±:** `SRC=` (ì¶œë°œì§€ IP) ë° `DPT=` (ëª©ì ì§€ í¬íŠ¸) ì •ë³´ë¥¼ ì •ê·œì‹ì„ í†µí•´ ì¶”ì¶œí•©ë‹ˆë‹¤.
  * **ìƒìœ„ Nê°œ ì§‘ê³„:** ì ‘ì† ì‹œë„ íšŸìˆ˜ê°€ ë§ì€ ìˆœì„œëŒ€ë¡œ IPë¥¼ ì •ë ¬í•˜ê³  ìƒìœ„ Nê°œ(`--top` ì˜µì…˜)ë§Œ ì„ íƒí•©ë‹ˆë‹¤.
  * **Geo-IP êµì°¨ ê²€ì¦:** 3ê°œì˜ ë¬´ë£Œ Geo-IP API (`ip-api.com`, `ipinfo.io`, `ipapi.co`)ë¥¼ ë™ì‹œì— í˜¸ì¶œí•˜ì—¬ ê²°ê³¼ë¥¼ ë¹„êµí•©ë‹ˆë‹¤. (í•˜ë‚˜ì˜ APIê°€ ì‹¤íŒ¨í•˜ê±°ë‚˜ ë¶€ì •í™•í•œ ì •ë³´ë¥¼ ì¤˜ë„ ë¹„êµ ê°€ëŠ¥)
  * **CSV ì¶œë ¥:** ë¶„ì„ëœ ê²°ê³¼ë¥¼ í‘œì¤€ ì¶œë ¥(stdout)ìœ¼ë¡œ CSV í¬ë§·ì— ë§ê²Œ ì¶œë ¥í•˜ì—¬, íŒŒì¼ë¡œ ì €ì¥í•˜ê±°ë‚˜ ë‹¤ë¥¸ ë„êµ¬ì™€ ì—°ë™í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.

## 3\. âš™ï¸ ì‚¬ì „ ìš”êµ¬ì‚¬í•­

  * Python 3 (`#!/usr/bin/env python3`)
  * `requests` ë¼ì´ë¸ŒëŸ¬ë¦¬ (ì™¸ë¶€ API í˜¸ì¶œìš©)
  * ë¶„ì„í•  UFW ë¡œê·¸ íŒŒì¼ (ì˜ˆ: `/var/log/ufw.log`)
  * ì¸í„°ë„· ì—°ê²° (Geo-IP API í˜¸ì¶œì„ ìœ„í•´ í•„ìš”)

## 4\. ğŸ“¦ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì „ `requests` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

```shell
pip install requests
```

(ë˜ëŠ” `pip3 install requests`)

## 5\. ğŸš€ ì‚¬ìš© ë°©ë²•

ìŠ¤í¬ë¦½íŠ¸ëŠ” `logfile` ì¸ìë¥¼ í•„ìˆ˜ë¡œ ë°›ìœ¼ë©°, `--top` (ë˜ëŠ” `-n`) ì˜µì…˜ìœ¼ë¡œ ì¡°íšŒí•  IP ê°œìˆ˜ë¥¼ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ê¸°ë³¸ ì‚¬ìš©ë²• (ìƒìœ„ 20ê°œ IP ë¶„ì„):**

```shell
python3 log_analyzer.py /var/log/ufw.log
```

**ìƒìœ„ 10ê°œ IPë§Œ ë¶„ì„:**

```shell
python3 log_analyzer.py /var/log/ufw.log --top 10
```

**ê²°ê³¼ë¥¼ CSV íŒŒì¼ë¡œ ì €ì¥:**
ìŠ¤í¬ë¦½íŠ¸ëŠ” ê²°ê³¼ë¥¼ í‘œì¤€ ì¶œë ¥(stdout)ìœ¼ë¡œ ë‚´ë³´ë‚´ë¯€ë¡œ, `>` ë¦¬ë‹¤ì´ë ‰ì…˜(redirection)ì„ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.

```shell
python3 log_analyzer.py /var/log/ufw.log -n 50 > ufw_report.csv
```

## 6\. ğŸ“Š ì¶œë ¥ CSV ì»¬ëŸ¼ ì„¤ëª…

ì¶œë ¥ë˜ëŠ” CSV íŒŒì¼ì˜ í—¤ë”ì™€ ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

| Source IP | API1\_Country | API1\_City | API2\_Country | API2\_City | API3\_Country | API3\_City | Attempts | Ports |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1.2.3.4 | China | Beijing | CN | Beijing | China | Beijing | 1050 | 22,80,443 |
| 5.6.7.8 | United States | Ashburn | US | Ashburn | United States | Ashburn | 850 | 22 |
| 9.9.9.9 | (None) | (None) | KR | Seoul | Korea, Republic of | Seoul | 120 | 5000,8080 |

  * **Source IP:** ì ‘ì†ì„ ì‹œë„í•œ IP ì£¼ì†Œ
  * **API(1/2/3)\_Country/City:** ìŠ¤í¬ë¦½íŠ¸ ë‚´ `GEO_APIS`ì— ì •ì˜ëœ 3ê°œ APIì˜ ì‘ë‹µ ê²°ê³¼ (API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ `(None)`ìœ¼ë¡œ í‘œì‹œ)
  * **Attempts:** í•´ë‹¹ IPì˜ ì´ ë¡œê·¸ ë°œê²¬ íšŸìˆ˜ (ì‹œë„ íšŸìˆ˜)
  * **Ports:** í•´ë‹¹ IPê°€ ì ‘ì† ì‹œë„í•œ ìœ ë‹ˆí¬í•œ í¬íŠ¸ ëª©ë¡ (ì‰¼í‘œë¡œ êµ¬ë¶„)
