## 📜 check\_port.sh 스크립트 메뉴얼 (md)

# check\_port.sh: 심층 네트워크 진단 스크립트 메뉴얼

## 1\. 📋 개요

이 스크립트는 Docker 컨테이너(특히 `grafana`, 포트 `3000`)에 대한 외부 접속 문제를 진단하기 위해 설계된 **자동화된 심층 네트워크 점검 도구**입니다.

"컨테이너는 분명히 실행 중인데 왜 외부에서 접속이 안 되지?"라는 일반적인 문제를 해결하기 위해, 스크립트는 서버 내부의 4가지 핵심 영역을 순차적으로 점검합니다.

1.  커널 IP 포워딩 기능
2.  컨테이너 내부 서비스의 정상 동작 여부
3.  IPTABLES `FORWARD` 체인 정책 (방화벽)
4.  IPTABLES `NAT` 테이블 규칙 (포트 포워딩)

모든 내부 점검이 정상이면, 문제는 서버 외부(보안 그룹, 물리 방화벽 등)에 있음을 알려줍니다.

## 2\. ⚙️ 사전 요구사항

  * **실행 위치:** Docker 컨테이너가 실행 중인 **호스트 서버**
  * **필요 권한:** `sudo` (IPTABLES 규칙을 확인하기 위해 필요)
  * **필수 유틸리티:** `docker`, `curl`, `sysctl`, `awk`, `grep` (대부분 기본 설치)
  * **인증 (Authentication):** `docker` 명령어를 `sudo` 없이 사용할 수 있거나, 스크립트 자체를 `sudo`로 실행해야 할 수 있습니다.

## 3\. ⚠️ 중요: 스크립트의 하드코딩된 값

이 스크립트는 **특정 환경에 맞춰져 있습니다.** 다른 환경에서 사용하려면 아래 값을 수정해야 합니다.

  * **포트:** `3000` (스크립트 전반)
  * **컨테이너 이름:** `grafana`
  * **외부 IP (점검용):** `172.22.204.22`, `172.22.204.24`
  * **Docker Compose 경로 (안내용):** `/home/ubuntu/prometheus/`


## 4\. 🚀 사용 방법

1.  **파일 저장:** 위 내용을 `check_port.sh` 이름으로 저장합니다.

2.  **실행 권한 부여:**

    ```shell
    chmod +x check_port.sh
    ```

3.  **스크립트 실행:** (문제가 되는 Docker 호스트 서버에서)

    ```shell
    ./check_port.sh
    ```

    또는 `sudo` 권한 문제 발생 시

    ```shell
    sudo ./check_port.sh
    ```

## 5\. 📊 출력 및 진단 예시

스크립트를 실행하면 1번부터 5번까지 각 단계의 결과를 `[정상]` 또는 `[문제]` 태그와 함께 보여줍니다.

  * **1\~4번 중 `[문제]`가 발생한 경우:**

      * 스크립트가 제시하는 `[문제]`의 원인과 해결 방법을 먼저 따르세요. 예를 들어 `[문제!] IP 포워딩 기능이 비활성화되어 있습니다.`가 출력되면 제시된 해결 방법을 수행해야 합니다.

  * **1\~4번이 모두 `[정상]`으로 나온 경우:**

      * 서버 내부 설정(커널, Docker, IPTABLES)은 문제가 없을 확률이 높습니다.
      * 스크립트가 5번 항목(최종 결론)에서 제안하는 것처럼, 서버 **외부**의 방화벽(클라우드 서비스의 보안 그룹, 사내 네트워크의 물리 방화벽 등) 설정을 확인해야 합니다.
